I"
Ù<h2 id="time-varing-volatility-modeling">Time-varing volatility modeling</h2>

<p>Check this website for more theoretical details: <a href="https://vlab.stern.nyu.edu/docs">Vlab of NYU</a>.</p>

<h3 id="example-1-real-gdp-growth-rate-in-usa">Example 1: real GDP growth rate in USA</h3>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17378762703630.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="600px" class="align-center" /></p>

<p><img src="https://bens-1-pics.oss-cn-hongkong.aliyuncs.com/uPic/2025/02/21/1935image-20250221193527325.png" alt="" width="600px" class="align-center" /></p>

<h3 id="example-2-sp500-index-return">Example 2: S&amp;P500 Index Return</h3>
<ul>
  <li>Daily Returns</li>
</ul>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17378766412658.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="600px" class="align-center" /></p>

<p>In fact, by ploting the ACF(Autocorrelation Funciton) and PACF(Partial Autocorrelation Function), we can find strong autocorrelations of the squared returns, absolute returns and High-Low returns ${ln(Y_t^H/Y_t^L)}$.</p>

<ul>
  <li>
    <p>$r_t$: not significant autocorrelation
<img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17378813766988.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="600px" class="align-center" /></p>
  </li>
  <li>
    <p>$r_t^2$:significant autocorrelation
<img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17378813953235.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="600px" class="align-center" /></p>
  </li>
  <li>
    <p>$|r_t|$:significant autocorrelation
<img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17378814083903.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="600px" class="align-center" /></p>
  </li>
  <li>
    <p>${ln(Y_t^H/Y_t^L)}$:significant autocorrelation
<img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17378814282787.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="600px" class="align-center" /></p>
  </li>
</ul>

<p>Codes:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="n">sp</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="n">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.api</span> <span class="kn">import</span> <span class="n">qqplot</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">var_ntime</span> <span class="c1"># my library
</span>
<span class="kn">from</span> <span class="nn">WindPy</span> <span class="kn">import</span> <span class="n">w</span>
<span class="n">w</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">error_code</span><span class="p">,</span> <span class="n">price</span> <span class="o">=</span> <span class="n">w</span><span class="p">.</span><span class="n">wsd</span><span class="p">(</span><span class="s">"000001.SH"</span><span class="p">,</span> <span class="s">"close"</span><span class="p">,</span> <span class="s">"2001-01-01"</span><span class="p">,</span> <span class="s">"2021-01-05"</span><span class="p">,</span> <span class="s">"PriceAdj=F"</span><span class="p">,</span><span class="n">usedf</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">price</span><span class="o">=</span><span class="n">price</span><span class="p">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s">"any"</span><span class="p">)</span>
<span class="n">price</span><span class="p">.</span><span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">price</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">logr</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">price</span><span class="p">).</span><span class="n">diff</span><span class="p">().</span><span class="n">dropna</span><span class="p">()</span>
<span class="c1"># or returns=100*price.pct_change().dropna()
# Here the returns are multiplied by 100, so that the number is around 1-100, which helps the following model fitting process.
</span>
<span class="c1"># check the normality of r
</span><span class="n">qplot1</span><span class="o">=</span><span class="n">qqplot</span><span class="p">(</span><span class="n">logr</span><span class="p">[</span><span class="s">'CLOSE'</span><span class="p">],</span><span class="n">line</span><span class="o">=</span><span class="s">'s'</span><span class="p">)</span>
<span class="c1"># or use my hist gragh
</span><span class="n">var_ntime</span><span class="p">.</span><span class="n">myhist</span><span class="p">(</span><span class="n">logr</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Test the serial correlation with ACF and PACF
</span><span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>
<span class="n">acfs</span><span class="o">=</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">logr</span><span class="p">)</span>
<span class="n">pacfs</span><span class="o">=</span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">logr</span><span class="p">)</span>

<span class="c1"># check volatility clusering
# squared return
</span><span class="n">acfs</span><span class="o">=</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">logr</span><span class="p">.</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">pacfs</span><span class="o">=</span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">logr</span><span class="p">.</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># aboslute return
</span><span class="n">acfs</span><span class="o">=</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">logr</span><span class="p">.</span><span class="nb">abs</span><span class="p">())</span>
<span class="n">pacfs</span><span class="o">=</span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">logr</span><span class="p">.</span><span class="nb">abs</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="simple-specications-for-conditional-variance">Simple specications for conditional variance</h2>

<p>Two models that are data-driven specifications:</p>
<ul>
  <li>
    <p>Rolling window average or moving average (MA)
  \(\hat{\sigma}_{t+1 \mid t}^2=\frac{1}{n} \sum_{i=1}^n\left(r_{t+1-i}-\mu\right)^2=\frac{1}{n} \times\left(\left(r_t-\mu\right)^2+\left(r_{t-1}-\mu\right)^2+\cdots+\left(r_{t-n}-\mu\right)^2\right)\)</p>
  </li>
  <li>
    <p>Exponentially Weighted Moving Average (EWMA) or RiskMetrics model.</p>
  </li>
</ul>

\[x_{t \mid t-1}^2=\frac{x_{t-1}^2+\lambda^1 x_{t-2}^2+\lambda^2 x_{t-3}^2+\cdots+\lambda^{\infty} x_{\infty}^2}{1+\lambda^1+\lambda^2+\cdots+\lambda^{n-1}+\cdots+\lambda^{\infty}} ; \text{ } \lambda \epsilon(0,1)\]

\[\hat{\sigma}_{t+1 \mid t}^2=(1-\lambda)\left(r_t-\mu\right)^2+\lambda \hat{\sigma}_{t \mid t-1}^2\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">historical_volatility</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="s">'origin'</span><span class="p">):</span>
    <span class="s">"""MA standard deviation"""</span>
    <span class="k">if</span> <span class="n">align</span><span class="o">==</span><span class="s">'origin'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">returns</span><span class="p">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="n">min_periods</span><span class="p">).</span><span class="n">std</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">align</span><span class="o">==</span><span class="s">'target'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">returns</span><span class="p">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span><span class="n">min_periods</span><span class="p">).</span><span class="n">std</span><span class="p">().</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"plese choose the align way: origin or target"</span><span class="p">)</span>
        <span class="k">return</span>

<span class="k">def</span> <span class="nf">ewma_volatility</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">lambda_param</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="s">'origin'</span><span class="p">):</span>
    <span class="s">"""EWMA standard deviation, Assume ùúÜ=0.94 as in RiskMetrics for daily returns"""</span>
    <span class="n">returns2</span><span class="o">=</span><span class="n">returns</span><span class="o">-</span><span class="n">returns</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">returns2</span><span class="o">=</span><span class="n">returns2</span><span class="p">.</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">returns2</span><span class="p">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">lambda_param</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">align</span><span class="o">==</span><span class="s">'origin'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">align</span><span class="o">==</span><span class="s">'target'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">).</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"plese choose the align way: origin or target"</span><span class="p">)</span>
        <span class="k">return</span>


<span class="k">def</span> <span class="nf">ewma_volatility2</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">lambda_param</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="s">'origin'</span><span class="p">):</span>
    <span class="s">"""EWMA standard deviation with EWMA mean"""</span>
    <span class="c1">#alternaively use the ewm().var(), in which the mean is the EWM mean
</span>    <span class="n">var</span> <span class="o">=</span> <span class="n">returns</span><span class="p">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">lambda_param</span><span class="p">,</span><span class="n">min_periods</span><span class="o">=</span><span class="n">min_periods</span><span class="p">).</span><span class="n">var</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">align</span><span class="o">==</span><span class="s">'origin'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">align</span><span class="o">==</span><span class="s">'target'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">).</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"plese choose the align way: origin or target"</span><span class="p">)</span>
        <span class="k">return</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Example:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="n">dt</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">arch</span> <span class="kn">import</span> <span class="n">arch_model</span>
<span class="kn">import</span> <span class="nn">arch.data.sp500</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="n">sp</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">arch</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">sp500</span><span class="p">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">returns</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="s">'Adj Close'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">).</span><span class="n">diff</span><span class="p">().</span><span class="n">dropna</span><span class="p">()</span>


<span class="n">sigma1</span><span class="o">=</span><span class="n">historical_volatility</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="s">'target'</span><span class="p">)</span>
<span class="n">sigma2</span><span class="o">=</span><span class="n">ewma_volatility</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="s">'target'</span><span class="p">)</span>
<span class="n">sigma</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sigma1</span><span class="p">,</span><span class="n">sigma2</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sigma</span><span class="p">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'MA-std'</span><span class="p">,</span><span class="s">'EWMA-std'</span><span class="p">]</span>
<span class="n">sigma</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># check the outliers
</span><span class="n">q</span><span class="o">=</span><span class="n">sp</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">norm</span><span class="p">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
<span class="k">print</span><span class="p">((</span><span class="n">returns</span><span class="o">&lt;</span><span class="n">q</span><span class="o">*</span><span class="n">sigma1</span><span class="p">).</span><span class="n">mean</span><span class="p">())</span>
<span class="c1">#0.056262425447316106
</span><span class="k">print</span><span class="p">((</span><span class="n">returns</span><span class="o">&lt;</span><span class="n">q</span><span class="o">*</span><span class="n">sigma2</span><span class="p">).</span><span class="n">mean</span><span class="p">())</span>
<span class="c1">#0.05745526838966203
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17401273830114.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<p>Set the window for MA-std to be 50 instead of 100 may give the similar result to EWMA($\lambda$ =0.94)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">sigma1</span><span class="o">=</span><span class="n">historical_volatility</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="mi">50</span><span class="p">).</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sigma2</span><span class="o">=</span><span class="n">ewma_volatility</span><span class="p">(</span><span class="n">returns</span><span class="p">).</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sigma</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sigma1</span><span class="p">,</span><span class="n">sigma2</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sigma</span><span class="p">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'MA-std-50D'</span><span class="p">,</span><span class="s">'EWMA-std'</span><span class="p">]</span>
<span class="n">sigma</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17401274839669.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<h2 id="introduction-to-garch-models">Introduction to GARCH models</h2>

<p>A basic GARCH model is specified as:
\(\begin{eqnarray} r_t &amp; = &amp; \mu + \epsilon_t \\ \epsilon_t &amp; = &amp; \sigma_t e_t \\ \sigma^2_t &amp; = &amp; \omega + \alpha \epsilon_{t-1}^2 + \beta \sigma^2_{t-1} \end{eqnarray}\)</p>

<p>A complete ARCH model is divided into three components:</p>

<ul>
  <li>a <strong>mean</strong> model, e.g., a constant mean or an ARX;</li>
  <li>a <strong>volatility</strong> process, e.g., a GARCH or an EGARCH process; and</li>
  <li>a <strong>distribution</strong> for the standardized residuals.</li>
</ul>

<p>The standard steps of using:<a href="https://bashtage.github.io/arch/doc/">ARCH Package</a></p>

<ol>
  <li>Construct by specifying the params</li>
  <li>Train (fit) and backtest with train-test split</li>
  <li>Forecast: the volatility</li>
  <li>Forecast: the VAR</li>
</ol>

<p><code class="language-plaintext highlighter-rouge">arch.univariate.arch_model(y, x=None, mean='Constant', lags=0, vol='Garch', p=1, o=0, q=1, power=2.0, dist='Normal', hold_back=None, rescale=None)</code></p>

<p>By default, it is a GARCH(p=1,o=0,q=1) with constant mean model.
\(\sigma^2_t = \omega + \alpha \epsilon_{t-1}^2 + \gamma \epsilon_{t-1}^2 I_{[\epsilon_{t-1}&lt;0]}+ \beta \sigma_{t-1}^2\)</p>

<p>Parameters</p>

<ul>
  <li>
    <p><strong>y</strong> (<em>{ndarray<strong>,* *Series</strong>,</em> <em>None}</em>) ‚Äì The dependent variable</p>
  </li>
  <li>
    <p><strong>x</strong> (<em>{np.array<strong>,* *DataFrame}</strong>,</em> <em>optional</em>) ‚Äì Exogenous regressors. Ignored if model does not permit exogenous regressors.</p>
  </li>
  <li>
    <p><strong>mean</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#str"><em>str</em></a><em>,</em> <em>optional</em>) ‚Äì Name of the mean model. Currently supported options are: ‚ÄòConstant‚Äô, ‚ÄòZero‚Äô, ‚ÄòLS‚Äô, ‚ÄòAR‚Äô, ‚ÄòARX‚Äô, ‚ÄòHAR‚Äô and ‚ÄòHARX‚Äô</p>
  </li>
  <li>
    <p><strong>lags</strong> (<a href="https://docs.python.org/3/library/functions.html#int"><em>int</em></a> <em>or</em> <a href="https://docs.python.org/3/library/stdtypes.html#list"><em>list</em></a> <em>(</em><a href="https://docs.python.org/3/library/functions.html#int"><em>int</em></a><em>)**,</em> <em>optional</em>) ‚Äì Either a scalar integer value indicating lag length or a list of integers specifying lag locations.</p>
  </li>
  <li>
    <p><strong>vol</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#str"><em>str</em></a><em>,</em> <em>optional</em>) ‚Äì Name of the volatility model. Currently supported options are: ‚ÄòGARCH‚Äô (default), ‚ÄòARCH‚Äô, ‚ÄòEGARCH‚Äô, ‚ÄòFIARCH‚Äô and ‚ÄòHARCH‚Äô</p>
  </li>
  <li>
    <p><strong>p</strong> (<a href="https://docs.python.org/3/library/functions.html#int"><em>int</em></a><em>,</em> <em>optional</em>) ‚Äì Lag order of the symmetric innovation</p>
  </li>
  <li>
    <p><strong>o</strong> (<a href="https://docs.python.org/3/library/functions.html#int"><em>int</em></a><em>,</em> <em>optional</em>) ‚Äì Lag order of the asymmetric innovation</p>
  </li>
  <li>
    <p><strong>q</strong> (<a href="https://docs.python.org/3/library/functions.html#int"><em>int</em></a><em>,</em> <em>optional</em>) ‚Äì Lag order of lagged volatility or equivalent</p>
  </li>
  <li>
    <p><strong>power</strong> (<a href="https://docs.python.org/3/library/functions.html#float"><em>float</em></a><em>,</em> <em>optional</em>) ‚Äì Power to use with GARCH and related models</p>
  </li>
  <li>
    <p><strong>dist</strong> (<a href="https://docs.python.org/3/library/functions.html#int"><em>int</em></a><em>,</em> <em>optional</em>) ‚Äì</p>

    <p>Name of the error distribution. Currently supported options are:</p>

    <blockquote>
      <ul>
        <li>Normal: ‚Äònormal‚Äô, ‚Äògaussian‚Äô (default)</li>
        <li>Students‚Äôs t: ‚Äòt‚Äô, ‚Äòstudentst‚Äô</li>
        <li>Skewed Student‚Äôs t: ‚Äòskewstudent‚Äô, ‚Äòskewt‚Äô</li>
        <li>Generalized Error Distribution: ‚Äòged‚Äô, ‚Äògeneralized error‚Äù</li>
      </ul>
    </blockquote>
  </li>
  <li>
    <p><strong>hold_back</strong> (<a href="https://docs.python.org/3/library/functions.html#int"><em>int</em></a>) ‚Äì Number of observations at the start of the sample to exclude when estimating model parameters. Used when comparing models with different lag lengths to estimate on the common sample.</p>
  </li>
  <li>
    <p><strong>rescale</strong> (<a href="https://docs.python.org/3/library/functions.html#bool"><em>bool</em></a>) ‚Äì Flag indicating whether to automatically rescale data if the scale of the data is likely to produce convergence issues when estimating model parameters. If False, the model is estimated on the data without transformation. If True, than y is rescaled and the new scale is reported in the estimation results.</p>
  </li>
</ul>

<p>Alternative mean and volatility processes can be directly specified</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="s">'AR'</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s">'harch'</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This example demonstrates the construction of a zero mean process with a TARCH volatility process and Student t error distribution</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="s">'zero'</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">power</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s">'StudentsT'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="construction">Construction</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="n">dt</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">arch.data.sp500</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">arch</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">sp500</span><span class="p">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">returns</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="s">'Adj Close'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">).</span><span class="n">diff</span><span class="p">().</span><span class="n">dropna</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">arch</span> <span class="kn">import</span> <span class="n">arch_model</span>
<span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span><span class="n">dist</span><span class="o">=</span><span class="s">'StudentsT'</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">o</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="fittingtraining">Fitting/Training</h3>

<h4 id="the-general-method">The general method</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">split_date</span><span class="o">=</span><span class="n">dt</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># will not be inlcuded in the samole
</span><span class="n">res</span> <span class="o">=</span> <span class="n">am</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">last_obs</span><span class="o">=</span><span class="n">split_date</span><span class="p">)</span>
<span class="n">res</span><span class="p">.</span><span class="n">summary</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17395191682932.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="600px" class="align-center" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">fig</span><span class="o">=</span><span class="n">res</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">annualize</span><span class="o">=</span><span class="s">'D'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17395191880736.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<p>some params in fitting process:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">update_freq=1</code>: controls the frequency of output form the optimizer</li>
  <li><code class="language-plaintext highlighter-rouge">disp=on</code> or <code class="language-plaintext highlighter-rouge">disp=off</code>: controls whether convergence information is returned</li>
  <li><code class="language-plaintext highlighter-rouge">last_obs</code>: it follow Python sequence rules so that the <strong>actual date in last_obs</strong> is <strong><em>not</em></strong> in the sample. 8Therefore, the last result in the <code class="language-plaintext highlighter-rouge">res.resid.dropna()</code> will be of the date <code class="language-plaintext highlighter-rouge">2013-12-31</code>.</li>
</ul>

<h4 id="fixing-parameters">Fixing Parameters</h4>

<p>In some circumstances, fixed rather than estimated parameters might be of interest.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">fix_res</span><span class="o">=</span><span class="n">am</span><span class="p">.</span><span class="n">fix</span><span class="p">([</span><span class="mf">0.06</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.08</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">fix_res</span><span class="p">.</span><span class="n">summary</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Checked the fitted params vs fixed params model performance:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">res</span><span class="p">.</span><span class="n">conditional_volatility</span><span class="p">,</span><span class="n">fix_res</span><span class="p">.</span><span class="n">conditional_volatility</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'estemated'</span><span class="p">,</span><span class="s">'fixed'</span><span class="p">]</span>
<span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="s">'ggplot'</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17396173959962.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">fig1</span><span class="o">=</span><span class="n">res</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">fig2</span><span class="o">=</span><span class="n">fix_res</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17396175595244.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" />
<img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17396175683558.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<p>Notice that, the fixed parameters created model by <code class="language-plaintext highlighter-rouge">fix_res=am.fix([parameters...])</code> will cover the whole sample.</p>

<h4 id="build-from-components">Build from components</h4>

<p>Create the mean model, and then add the volatility model, and change the distribution model in the end.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">arch.data.core_cpi</span>
<span class="n">core_cpi</span> <span class="o">=</span> <span class="n">arch</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">core_cpi</span><span class="p">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">ann_inflation</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">core_cpi</span><span class="p">.</span><span class="n">CPILFESL</span><span class="p">.</span><span class="n">pct_change</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="n">dropna</span><span class="p">()</span>
<span class="c1">#Here pct_change(n): n means the periods to shift for forming percent change.
</span><span class="n">fig</span> <span class="o">=</span> <span class="n">ann_inflation</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>Step 1: Auto-regression model to estimate the mean:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">arch.univariate</span> <span class="kn">import</span> <span class="n">ARX</span>
<span class="n">ar</span> <span class="o">=</span> <span class="n">ARX</span><span class="p">(</span><span class="n">ann_inflation</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">ar</span><span class="p">.</span><span class="n">fit</span><span class="p">().</span><span class="n">summary</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17396182676693.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="600px" class="align-center" /></p>

<ul>
  <li>Step 2:Add a volatility model:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">arch.univariate</span> <span class="kn">import</span> <span class="n">ARCH</span><span class="p">,</span> <span class="n">GARCH</span>

<span class="n">ar</span><span class="p">.</span><span class="n">volatility</span> <span class="o">=</span> <span class="n">ARCH</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">ar</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="s">'off'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">summary</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17396182859761.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="600px" class="align-center" /></p>

<ul>
  <li>Step 3: Finally the distribution can be changed from the default normal to a standardized Student‚Äôs T using the distribution property of a mean model.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">arch.univariate</span> <span class="kn">import</span> <span class="n">StudentsT</span>
<span class="n">ar</span><span class="p">.</span><span class="n">distribution</span> <span class="o">=</span> <span class="n">StudentsT</span><span class="p">()</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">ar</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="s">'off'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">summary</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="return-of-the-fitted-model">return of the fitted model</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">arch</span> <span class="kn">import</span> <span class="n">arch_model</span>
<span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span><span class="n">dist</span><span class="o">=</span><span class="s">'StudentsT'</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">o</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">am</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">last_obs</span><span class="o">=</span><span class="n">dt</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">help</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">conditional_volatility</code> $\sigma$: square root of conditional variance. The values are aligned with the input data so that the value in the t-th position is the variance of t-th error, which is computed using time-(t-1) information.</li>
  <li><code class="language-plaintext highlighter-rouge">params</code> : Estimated parameters</li>
  <li><code class="language-plaintext highlighter-rouge">resid</code>: Residuals from model</li>
  <li><code class="language-plaintext highlighter-rouge">volatility</code>: volatility from model</li>
  <li><code class="language-plaintext highlighter-rouge">model</code>:The model object used to estimate the parameters</li>
  <li><code class="language-plaintext highlighter-rouge">fit_start</code>: Start of sample used to estimate parameters</li>
  <li><code class="language-plaintext highlighter-rouge">fit_stop</code>: End of sample used to estimate parameters</li>
  <li><code class="language-plaintext highlighter-rouge">summary()</code>: Constructs a summary of the results from a fit model.</li>
  <li><code class="language-plaintext highlighter-rouge">forecast()</code>:  Construct forecasts from estimated model.</li>
</ul>

<h3 id="forecasts">Forecasts</h3>

<h4 id="three-mothods">Three mothods</h4>

<p>Forecasts here mean the conditional expectation of the future Mean, Volatility, and etc. All arch_models here support three methods of forecasting:</p>

<ul>
  <li>Analytical(Parameter method):
    <ul>
      <li>Always available for the 1-step</li>
      <li>Multi-step analytical forecasts are only available for GARCH or HARCH and certain linear models.These forecasts exploit the relationship $E_t[\epsilon_{t+1}^2] = \sigma_{t+1}$ to recursively compute forecasts</li>
    </ul>
  </li>
  <li>Simulation(Monte-carlo simulation):
    <ul>
      <li>only useful for horizons larger than 1</li>
      <li>the standardized residuals are <strong>simulated by the assumed distribution</strong> of residuals, e.g., a Normal or Student‚Äôs t.</li>
    </ul>
  </li>
  <li>Bootstrap(Historical method):
    <ul>
      <li>similar to Simulation method, except:</li>
      <li>the <strong>standardized residuals from the actual data are used</strong> in the estimation rather than assuming a specific distribution.</li>
    </ul>
  </li>
</ul>

<h4 id="call-of-forecaste">call of forecaste()</h4>

<p>The <a href="https://bashtage.github.io/arch/doc/univariate/generated/generated/arch.univariate.base.ARCHModelResult.forecast.html#arch.univariate.base.ARCHModelResult.forecast"><code class="language-plaintext highlighter-rouge">forecast()</code></a> method is attached to a model fit result.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">params</code> - The model parameters used to forecast the mean and variance. If not specified, the parameters estimated during the call to <code class="language-plaintext highlighter-rouge">fit</code> the produced the result are used.</li>
  <li><code class="language-plaintext highlighter-rouge">horizon</code> - A positive integer value indicating the maximum horizon to produce forecasts.</li>
  <li><code class="language-plaintext highlighter-rouge">start</code> - A positive integer or, if the input to the mode is a DataFrame, a date (string, datetime, datetime64 or Timestamp). Forecasts are produced from <code class="language-plaintext highlighter-rouge">start</code> until the end of the sample. If not provided, <code class="language-plaintext highlighter-rouge">start</code> is set to the length of the insample-data minus 1.</li>
  <li><code class="language-plaintext highlighter-rouge">method</code> - One of ‚Äòanalytic‚Äô (default), ‚Äòsimulation‚Äô or ‚Äòbootstrap‚Äô that describes the method used to produce the forecasts. Not all methods are available for all horizons.</li>
  <li><code class="language-plaintext highlighter-rouge">simulations</code> - A non-negative integer indicating the number of simulation to use when <code class="language-plaintext highlighter-rouge">method</code> is ‚Äòsimulation‚Äô or ‚Äòbootstrap‚Äô</li>
  <li><code class="language-plaintext highlighter-rouge">align='origin'</code>: if forecast is called with <code class="language-plaintext highlighter-rouge">align="target"</code>, the forecasts are already aligned with the target and so do not need further shifting.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">forecasts</span><span class="o">=</span><span class="n">res</span><span class="p">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">forecasts</span><span class="p">.</span><span class="n">variance</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17396201142958.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="600px" class="align-center" /></p>

<p>The forecasts above are made with the data available in Day T for the following days. <code class="language-plaintext highlighter-rouge">2013-12-31</code>:</p>

<ul>
  <li>h.1 $\to$ <code class="language-plaintext highlighter-rouge">2014-01-02</code></li>
  <li>h.2 $\to$ <code class="language-plaintext highlighter-rouge">2014-01-03</code></li>
</ul>

<p>In order to make predicion, we need further shifting.</p>

<p>If forecast is called with <code class="language-plaintext highlighter-rouge">align="target"</code>, then the forecasts will already be aligned with the target day,and no further shifting is needed.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">forecasts</span><span class="o">=</span><span class="n">res</span><span class="p">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="s">'target'</span><span class="p">)</span>
<span class="n">forecasts</span><span class="p">.</span><span class="n">residual_variance</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17401030474516.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="200px" class="align-center" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1"># from the given start date
</span><span class="n">forecasts</span><span class="o">=</span><span class="n">res</span><span class="p">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="n">dt</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">31</span><span class="p">))</span>
<span class="n">forecasts</span><span class="p">.</span><span class="n">variance</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17396201606196.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<h4 id="return-or-forecast">return or forecast()</h4>

<p>Forecasts are contained in an <code class="language-plaintext highlighter-rouge">ARCHModelForecast</code> object which has 4 attributes:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mean</code> - The forecast means</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">residual_variance</code> - The forecast residual variances, that is $E_t[\epsilon_{t+h}^2]$</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">variance</code> - The forecast variance of the process, $E_t[r_{t+h}^2]$. The variance will differ from the residual variance whenever the model has mean dynamics, e.g., in an AR process.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">simulations</code> - An object that contains detailed information about the simulations used to generate forecasts. Only used if the forecast <code class="language-plaintext highlighter-rouge">method</code> is set to <code class="language-plaintext highlighter-rouge">'simulation'</code> or <code class="language-plaintext highlighter-rouge">'bootstrap'</code>. If using <code class="language-plaintext highlighter-rouge">'analytical'</code> (the default), this is <code class="language-plaintext highlighter-rouge">None</code>.</p>
  </li>
</ul>

<p>Lest‚Äôs check the performance of the model:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">forecasts</span><span class="o">=</span><span class="n">res</span><span class="p">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">forecasts</span><span class="p">.</span><span class="n">variance</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">temp1</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">returns</span><span class="p">[</span><span class="n">returns</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">year</span><span class="o">&gt;</span><span class="mi">2013</span><span class="p">],</span><span class="n">forecasts</span><span class="p">.</span><span class="n">variance</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">].</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))],</span><span class="mi">1</span><span class="p">)</span>
<span class="n">temp1</span><span class="p">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'returns'</span><span class="p">,</span><span class="s">'GARCH-std'</span><span class="p">]</span>
<span class="n">temp1</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17399568975243.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<p>Combine all the forecasts</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">fma</span><span class="o">=</span><span class="n">historical_volatility</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="s">'target'</span><span class="p">)</span>
<span class="n">fma</span><span class="o">=</span><span class="n">fma</span><span class="p">[</span><span class="s">'2014'</span><span class="p">:]</span>

<span class="n">fewma</span><span class="o">=</span><span class="n">ewma_volatility2</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="s">'target'</span><span class="p">)</span>
<span class="n">fewma</span><span class="o">=</span><span class="n">fewma</span><span class="p">[</span><span class="s">"2014"</span><span class="p">:]</span>

<span class="n">all_fores</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">temp1</span><span class="p">,</span><span class="n">fma</span><span class="p">,</span><span class="n">fewma</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
<span class="n">all_fores</span><span class="p">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'returns'</span><span class="p">,</span><span class="s">'GARCH-std'</span><span class="p">,</span><span class="s">'MA-std'</span><span class="p">,</span><span class="s">'EWMA-std'</span><span class="p">]</span>
<span class="n">all_fores</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17399562837746.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">all_fores</span><span class="p">[</span><span class="s">'2014-12'</span><span class="p">:</span><span class="s">'2015-12'</span><span class="p">].</span><span class="n">plot</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17401285095257.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<p>Check the forecasts of GARCH and EWMA</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">all_fores</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s">'GARCH-std'</span><span class="p">,</span><span class="s">'EWMA-std'</span><span class="p">]].</span><span class="n">plot</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17399571613804.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<h4 id="rolling-window-forecasting">Rolling Window Forecasting</h4>

<p>Rolling window forecasts use a fixed sample length and then produce one-step from the final observation. These can be implemented using <code class="language-plaintext highlighter-rouge">first_obs</code> and <code class="language-plaintext highlighter-rouge">last_obs</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="n">index</span> <span class="o">=</span> <span class="n">returns</span><span class="p">.</span><span class="n">index</span>
<span class="n">start_loc</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">end_loc</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s">'2010-1-1'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nb">min</span><span class="p">()</span>
<span class="n">forecasts</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'.'</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">am</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">first_obs</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">last_obs</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="n">end_loc</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="s">'off'</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mi">3</span><span class="p">).</span><span class="n">variance</span>
    <span class="n">fcast</span> <span class="o">=</span> <span class="n">temp</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">end_loc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">forecasts</span><span class="p">[</span><span class="n">fcast</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fcast</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">forecasts</span><span class="p">).</span><span class="n">T</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="recursive-forecast-generation">Recursive Forecast Generation</h4>

<p>Recursive is similar to rolling except that the initial observation does not change. This can be easily implemented by dropping the <code class="language-plaintext highlighter-rouge">first_obs</code> input.</p>

<h4 id="simulation-forecasts">Simulation forecasts</h4>

<p>For non-linear models (say TARCH), forecasts have no closed-form solution for horizons larger than 1. In this case we have to use the <code class="language-plaintext highlighter-rouge">forecast(mothod='simulation')</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">res</span><span class="p">.</span><span class="n">conditional_volatility</span><span class="p">[</span><span class="s">'2013'</span><span class="p">].</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># Simulation forecasts
</span><span class="n">forecasts_sim</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">'simulation'</span><span class="p">)</span>
<span class="n">sims</span> <span class="o">=</span> <span class="n">forecasts_sim</span><span class="p">.</span><span class="n">simulations</span>

<span class="c1"># Bootstrap forecasts
</span><span class="n">forecasts_bootstrap</span><span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">'bootstrap'</span><span class="p">)</span>
<span class="n">sims</span> <span class="o">=</span> <span class="n">forecasts_bootstrap</span><span class="p">.</span><span class="n">simulations</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Check the simulated lines:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">dd</span><span class="o">=</span><span class="mi">5</span> <span class="c1"># show one line every dd lines.
</span><span class="n">lines</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sims</span><span class="p">.</span><span class="n">residual_variances</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">::</span><span class="mi">5</span><span class="p">].</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#9cb2d6'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_label</span><span class="p">(</span><span class="s">'Simulated path'</span><span class="p">)</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">forecasts</span><span class="p">.</span><span class="n">variance</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#002868'</span><span class="p">)</span>
<span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_label</span><span class="p">(</span><span class="s">'Expected variance'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">gca</span><span class="p">().</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">gca</span><span class="p">().</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17399640892269.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<h4 id="value-at-risk-forecasting">Value-at-Risk Forecasting</h4>

<p>Value-at-Risk (VaR) forecasts from GARCH models depend on the conditional mean, the conditional volatility and the quantile of the standardized residualsÔºö</p>

\[VaR_{t+1|t} = \mu_{t+1|t} +q_{\alpha}  \sigma_{t+1|t}\]

<p>or take the absolute value of it:</p>

\[VaR_{t+1|t} = - \mu_{t+1|t} - q_{\alpha}  \sigma_{t+1|t}\]

<p>where $q_{\alpha}$ is the $\alpha$ quantile of the standardized residuals, e.g., 5%.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="n">forecasts</span><span class="o">=</span><span class="n">res</span><span class="p">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">align</span><span class="o">=</span><span class="s">'target'</span><span class="p">)</span>
<span class="n">cond_mean</span><span class="o">=</span><span class="n">forecasts</span><span class="p">.</span><span class="n">mean</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">cond_var</span><span class="o">=</span><span class="n">forecasts</span><span class="p">.</span><span class="n">variance</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">q</span><span class="o">=</span><span class="n">am</span><span class="p">.</span><span class="n">distribution</span><span class="p">.</span><span class="n">ppf</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.05</span><span class="p">],</span><span class="n">res</span><span class="p">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
<span class="c1">#here for student only 1 parameter nu
</span>
<span class="n">value_at_risk</span> <span class="o">=</span> <span class="n">cond_mean</span><span class="p">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cond_var</span><span class="p">).</span><span class="n">values</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">value_at_risk</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">value_at_risk</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'1%'</span><span class="p">,</span><span class="s">'5%'</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">cond_var</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">value_at_risk</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'GARCH VAR'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17401289798734.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<p>Notice:</p>

<p><code class="language-plaintext highlighter-rouge">scipy.t.ppf(alpha,df,loc,scale)</code> is the Inverse CDF of student‚Äôs t distribution. Therefore:</p>

<p><code class="language-plaintext highlighter-rouge">sp.stats.t.std(df=nu,loc=0,scale=1)</code> = $\sqrt\frac{v}{v-2}$</p>

<p><code class="language-plaintext highlighter-rouge">am.ditribution</code> is Standardized Student‚Äôs t distribution with only one parameter, which is <code class="language-plaintext highlighter-rouge">df</code> or $\nu$ (nu), with mean=0, std=1.</p>

<p><code class="language-plaintext highlighter-rouge">am.ditribution.ppf</code> is the Inverse CDF of <strong>standardiazed</strong> student‚Äôs t distribution. The following are equivalent for any v greater than 2</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">am.distribution.ppf(alpha,v)</code> for <code class="language-plaintext highlighter-rouge">dist='StudentsT'</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">sp.stats.t.ppf(alpha,df=v,loc=0,scale=np.sqrt((v-2)/v))</code></p>
  </li>
</ul>

<p>Let‚Äôs also consider Vars given by the MA and EWMA method:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="n">sp</span>
<span class="n">qq</span><span class="o">=</span><span class="n">sp</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">norm</span><span class="p">.</span><span class="n">ppf</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.05</span><span class="p">])</span>
<span class="n">mu</span><span class="o">=</span><span class="n">cond_mean</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">var_MA</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_fores</span><span class="p">[</span><span class="s">'MA-std'</span><span class="p">]).</span><span class="n">dropna</span><span class="p">().</span><span class="n">values</span><span class="o">*</span> <span class="n">qq</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">mu</span>
<span class="n">var_MA</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">var_MA</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'1%'</span><span class="p">,</span><span class="s">'5%'</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">all_fores</span><span class="p">[</span><span class="s">'MA-std'</span><span class="p">].</span><span class="n">dropna</span><span class="p">().</span><span class="n">index</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">var_MA</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'MA VAR'</span><span class="p">)</span>

<span class="n">var_EWMA</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_fores</span><span class="p">[</span><span class="s">'EWMA-std'</span><span class="p">]).</span><span class="n">dropna</span><span class="p">().</span><span class="n">values</span><span class="o">*</span> <span class="n">qq</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">mu</span>
<span class="n">var_EWMA</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">var_EWMA</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'1%'</span><span class="p">,</span><span class="s">'5%'</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">all_fores</span><span class="p">[</span><span class="s">'EWMA-std'</span><span class="p">].</span><span class="n">dropna</span><span class="p">().</span><span class="n">index</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">var_EWMA</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'EWMA VAR'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17401289637554.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17401289706026.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<h3 id="performance">Performance</h3>

<h4 id="var-scatter">Var Scatter</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">myVarScatter</span><span class="p">(</span><span class="n">rets</span><span class="p">,</span><span class="n">value_at_risk</span><span class="p">):</span>
    <span class="s">"""
    A simple scatter plot for given returns and Value-at-Risks: column_names=alphas,['1%','5%']
    alphas are expected to be ranked upwards: 1%, 5%; not 5%,1%
    Returns and Vars are expecetd to be indexed with similar dates.
    """</span>
    <span class="n">alphas</span><span class="o">=</span><span class="n">value_at_risk</span><span class="p">.</span><span class="n">columns</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">xl</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">value_at_risk</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">index</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
            <span class="n">c</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"#000000"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
            <span class="n">c</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"#BB0000"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"#BB00BB"</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">"object"</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"#BB00BB"</span><span class="p">:</span> <span class="s">f"</span><span class="si">{</span><span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> Exceedence"</span><span class="p">,</span>
        <span class="s">"#BB0000"</span><span class="p">:</span> <span class="s">f"</span><span class="si">{</span><span class="n">alphas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s"> Exceedence"</span><span class="p">,</span>
        <span class="s">"#000000"</span><span class="p">:</span> <span class="s">"No Exceedence"</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"#BB0000"</span><span class="p">:</span> <span class="s">"x"</span><span class="p">,</span> <span class="s">"#BB00BB"</span><span class="p">:</span> <span class="s">"s"</span><span class="p">,</span> <span class="s">"#000000"</span><span class="p">:</span> <span class="s">"o"</span><span class="p">}</span>
    <span class="n">sizes</span><span class="o">=</span><span class="p">{</span><span class="s">"#BB0000"</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s">"#BB00BB"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s">"#000000"</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="n">unique</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">c</span> <span class="o">==</span> <span class="n">color</span>
        <span class="n">ax</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">rets</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="n">sel</span><span class="p">],</span>
            <span class="n">rets</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sel</span><span class="p">],</span>
            <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">color</span><span class="p">],</span>
            <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="n">sel</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="n">sizes</span><span class="p">[</span><span class="n">color</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">color</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">"VaR Scatter"</span><span class="p">)</span>
    <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="n">unique</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">color</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="si">{</span> <span class="p">(</span><span class="n">c</span><span class="o">==</span><span class="n">color</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">return</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="garch-model">GARCH model</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">myVarScatter</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="s">"2015"</span><span class="p">:],</span><span class="n">value_at_risk</span><span class="p">[</span><span class="s">"2015"</span><span class="p">:])</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17401260894215.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<ul>
  <li>No Exceedence: 94.83%</li>
  <li>5% Exceedence: 3.58%</li>
  <li>1% Exceedence: 1.59%</li>
</ul>

<h4 id="ma">MA</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">myVarScatter</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="s">'2015'</span><span class="p">:],</span><span class="n">var_MA</span><span class="p">[</span><span class="s">'2015'</span><span class="p">:])</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17401261460487.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<ul>
  <li>No Exceedence: 93.24%</li>
  <li>5% Exceedence: 3.78%</li>
  <li>1% Exceedence: 2.98%</li>
</ul>

<h4 id="ewma">EWMA</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">myVarScatter</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="s">'2015'</span><span class="p">:],</span><span class="n">var_EWMA</span><span class="p">[</span><span class="s">'2015'</span><span class="p">:])</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2025/02/21/17401261460487.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" width="500px" class="align-center" /></p>

<ul>
  <li>No Exceedence: 94.33%</li>
  <li>5% Exceedence: 3.28%</li>
  <li>1% Exceedence: 2.39%</li>
</ul>

<h4 id="conclusion">Conclusion</h4>

<p>By comparison, the GARCH model have better performance in estimating 1%-VaR.</p>

<h3 id="codes">Codes</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="n">sp</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="n">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.api</span> <span class="kn">import</span> <span class="n">qqplot</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>


<span class="k">def</span> <span class="nf">historical_volatility</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">'origin'</span><span class="p">):</span>
    <span class="s">"""MA standard deviation"""</span>
    <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s">'origin'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">returns</span><span class="p">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">min_periods</span><span class="p">).</span><span class="n">std</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">align</span> <span class="o">==</span> <span class="s">'target'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">returns</span><span class="p">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">min_periods</span><span class="p">).</span><span class="n">std</span><span class="p">().</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"plese choose the align way: origin or target"</span><span class="p">)</span>
        <span class="k">return</span>


<span class="k">def</span> <span class="nf">ewma_volatility</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">lambda_param</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">'origin'</span><span class="p">):</span>
    <span class="s">"""EWMA standard deviation, Assume ùúÜ=0.94 as in RiskMetrics for daily returns"""</span>
    <span class="n">returns2</span> <span class="o">=</span> <span class="n">returns</span> <span class="o">-</span> <span class="n">returns</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">returns2</span> <span class="o">=</span> <span class="n">returns2</span><span class="p">.</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">returns2</span><span class="p">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lambda_param</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s">'origin'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">align</span> <span class="o">==</span> <span class="s">'target'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">).</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"plese choose the align way: origin or target"</span><span class="p">)</span>
        <span class="k">return</span>


<span class="k">def</span> <span class="nf">ewma_volatility2</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">lambda_param</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">'origin'</span><span class="p">):</span>
    <span class="s">"""EWMA standard deviation with EWMA mean"""</span>
    <span class="c1"># alternaively use the ewm().var(), in which the mean is the EWM mean
</span>    <span class="n">var</span> <span class="o">=</span> <span class="n">returns</span><span class="p">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lambda_param</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="n">min_periods</span><span class="p">).</span><span class="n">var</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s">'origin'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">align</span> <span class="o">==</span> <span class="s">'target'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">).</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"plese choose the align way: origin or target"</span><span class="p">)</span>
        <span class="k">return</span>


<span class="k">def</span> <span class="nf">myVarScatter</span><span class="p">(</span><span class="n">rets</span><span class="p">,</span> <span class="n">value_at_risk</span><span class="p">):</span>
    <span class="s">"""
    A simple scatter plot for given returns and Value-at-Risks: column_names=alphas,['1%','5%']
    alphas are expected to be ranked upwards: 1%, 5%; not 5%,1%
    Returns and Vars are expecetd to be indexed with similar dates.
    """</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">columns</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">xl</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">value_at_risk</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">index</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
            <span class="n">c</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"#000000"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
            <span class="n">c</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"#BB0000"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"#BB00BB"</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">"object"</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"#BB00BB"</span><span class="p">:</span> <span class="s">f"</span><span class="si">{</span><span class="n">alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> Exceedence"</span><span class="p">,</span>
        <span class="s">"#BB0000"</span><span class="p">:</span> <span class="s">f"</span><span class="si">{</span><span class="n">alphas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s"> Exceedence"</span><span class="p">,</span>
        <span class="s">"#000000"</span><span class="p">:</span> <span class="s">"No Exceedence"</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"#BB0000"</span><span class="p">:</span> <span class="s">"x"</span><span class="p">,</span> <span class="s">"#BB00BB"</span><span class="p">:</span> <span class="s">"s"</span><span class="p">,</span> <span class="s">"#000000"</span><span class="p">:</span> <span class="s">"o"</span><span class="p">}</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="p">{</span><span class="s">"#BB0000"</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s">"#BB00BB"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s">"#000000"</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="n">unique</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">c</span> <span class="o">==</span> <span class="n">color</span>
        <span class="n">ax</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">rets</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="n">sel</span><span class="p">],</span>
            <span class="n">rets</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sel</span><span class="p">],</span>
            <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">color</span><span class="p">],</span>
            <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="n">sel</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="n">sizes</span><span class="p">[</span><span class="n">color</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">color</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">"VaR Scatter"</span><span class="p">)</span>
    <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="n">unique</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">color</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="si">{</span> <span class="p">(</span><span class="n">c</span><span class="o">==</span><span class="n">color</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">return</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="c1"># get the data
</span>    <span class="kn">import</span> <span class="nn">arch.data.sp500</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">arch</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">sp500</span><span class="p">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">returns</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s">'Adj Close'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">).</span><span class="n">diff</span><span class="p">().</span><span class="n">dropna</span><span class="p">()</span>

    <span class="c1"># modelling and fitting
</span>    <span class="kn">from</span> <span class="nn">arch</span> <span class="kn">import</span> <span class="n">arch_model</span>
    <span class="n">am</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s">'StudentsT'</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">split_date</span> <span class="o">=</span> <span class="n">dt</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># will not be inlcuded in the sample
</span>    <span class="n">res</span> <span class="o">=</span> <span class="n">am</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">update_freq</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">last_obs</span><span class="o">=</span><span class="n">split_date</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>

    <span class="c1"># fixed params fit
</span>    <span class="n">fix_res</span> <span class="o">=</span> <span class="n">am</span><span class="p">.</span><span class="n">fix</span><span class="p">([</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">fix_res</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">res</span><span class="p">.</span><span class="n">conditional_volatility</span><span class="p">,</span>
                    <span class="n">fix_res</span><span class="p">.</span><span class="n">conditional_volatility</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'estemated'</span><span class="p">,</span> <span class="s">'fixed'</span><span class="p">]</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="n">use</span><span class="p">(</span><span class="s">'ggplot'</span><span class="p">)</span>
    <span class="n">df</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>

    <span class="c1"># forecasts
</span>    <span class="n">forecasts</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">forecast</span><span class="p">(</span>
        <span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">dt</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span> <span class="n">align</span><span class="o">=</span><span class="s">'target'</span><span class="p">)</span>

    <span class="c1"># Returns vs Standard deviation
</span>    <span class="n">temp1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">returns</span><span class="p">[</span><span class="n">returns</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">year</span> <span class="o">&gt;</span> <span class="mi">2013</span><span class="p">],</span>
                       <span class="n">forecasts</span><span class="p">.</span><span class="n">variance</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">temp1</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'returns'</span><span class="p">,</span> <span class="s">'GARCH-std'</span><span class="p">]</span>
    <span class="n">temp1</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>

    <span class="c1"># Returns vs all forecasts
</span>    <span class="n">fma</span> <span class="o">=</span> <span class="n">historical_volatility</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">'target'</span><span class="p">)</span>
    <span class="n">fma</span> <span class="o">=</span> <span class="n">fma</span><span class="p">[</span><span class="s">'2014'</span><span class="p">:]</span>

    <span class="n">fewma</span> <span class="o">=</span> <span class="n">ewma_volatility2</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">'target'</span><span class="p">)</span>
    <span class="n">fewma</span> <span class="o">=</span> <span class="n">fewma</span><span class="p">[</span><span class="s">"2014"</span><span class="p">:]</span>

    <span class="n">all_fores</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">temp1</span><span class="p">,</span> <span class="n">fma</span><span class="p">,</span> <span class="n">fewma</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">all_fores</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'returns'</span><span class="p">,</span> <span class="s">'GARCH-std'</span><span class="p">,</span> <span class="s">'MA-std'</span><span class="p">,</span> <span class="s">'EWMA-std'</span><span class="p">]</span>
    <span class="n">all_fores</span><span class="p">[</span><span class="s">'2014-12'</span><span class="p">:</span><span class="s">'2015-12'</span><span class="p">].</span><span class="n">plot</span><span class="p">()</span>

    <span class="c1"># rolling-window forecasts
</span>    <span class="n">index</span> <span class="o">=</span> <span class="n">returns</span><span class="p">.</span><span class="n">index</span>
    <span class="n">start_loc</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">end_loc</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s">'2010-1-1'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nb">min</span><span class="p">()</span>
    <span class="n">forecasts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'.'</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">am</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">first_obs</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">last_obs</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="n">end_loc</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="s">'off'</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mi">3</span><span class="p">).</span><span class="n">variance</span>
        <span class="n">fcast</span> <span class="o">=</span> <span class="n">temp</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">end_loc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">forecasts</span><span class="p">[</span><span class="n">fcast</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fcast</span>
    <span class="k">print</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">forecasts</span><span class="p">).</span><span class="n">T</span><span class="p">)</span>

    <span class="c1"># Var forecasts - GARCH
</span>    <span class="n">forecasts</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">'target'</span><span class="p">)</span>
    <span class="n">cond_mean</span> <span class="o">=</span> <span class="n">forecasts</span><span class="p">.</span><span class="n">mean</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">cond_var</span> <span class="o">=</span> <span class="n">forecasts</span><span class="p">.</span><span class="n">variance</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">am</span><span class="p">.</span><span class="n">distribution</span><span class="p">.</span><span class="n">ppf</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span> <span class="n">res</span><span class="p">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
    <span class="c1"># here for student only 1 parameter nu
</span>    <span class="n">value_at_risk</span> <span class="o">=</span> <span class="n">cond_mean</span><span class="p">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cond_var</span><span class="p">).</span><span class="n">values</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">value_at_risk</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">value_at_risk</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                                 <span class="s">'1%'</span><span class="p">,</span> <span class="s">'5%'</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">cond_var</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">value_at_risk</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'GARCH VAR'</span><span class="p">)</span>

    <span class="c1"># Var forecassts-MA and EWMA
</span>    <span class="n">qq</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">norm</span><span class="p">.</span><span class="n">ppf</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">cond_mean</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">var_MA</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">all_fores</span><span class="p">[</span><span class="s">'MA-std'</span><span class="p">]).</span><span class="n">dropna</span><span class="p">().</span><span class="n">values</span> <span class="o">*</span> <span class="n">qq</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">mu</span>
    <span class="n">var_MA</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">var_MA</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'1%'</span><span class="p">,</span> <span class="s">'5%'</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">all_fores</span><span class="p">[</span><span class="s">'MA-std'</span><span class="p">].</span><span class="n">dropna</span><span class="p">().</span><span class="n">index</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">var_MA</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'MA VAR'</span><span class="p">)</span>

    <span class="n">var_EWMA</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">all_fores</span><span class="p">[</span><span class="s">'EWMA-std'</span><span class="p">]).</span><span class="n">dropna</span><span class="p">().</span><span class="n">values</span> <span class="o">*</span> <span class="n">qq</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">mu</span>
    <span class="n">var_EWMA</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">var_EWMA</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'1%'</span><span class="p">,</span> <span class="s">'5%'</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">all_fores</span><span class="p">[</span><span class="s">'EWMA-std'</span><span class="p">].</span><span class="n">dropna</span><span class="p">().</span><span class="n">index</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">var_EWMA</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'EWMA VAR'</span><span class="p">)</span>

    <span class="c1"># Check the performance
</span>    <span class="n">myVarScatter</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="s">"2015"</span><span class="p">:],</span> <span class="n">value_at_risk</span><span class="p">[</span><span class="s">"2015"</span><span class="p">:])</span>
    <span class="n">myVarScatter</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="s">'2015'</span><span class="p">:],</span> <span class="n">var_MA</span><span class="p">[</span><span class="s">'2015'</span><span class="p">:])</span>
    <span class="n">myVarScatter</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="s">'2015'</span><span class="p">:],</span> <span class="n">var_EWMA</span><span class="p">[</span><span class="s">'2015'</span><span class="p">:])</span>

</pre></td></tr></tbody></table></code></pre></div></div>
:ET