I"e­<h2 id="quant-roles">Quant roles</h2>

<ul>
  <li>Data manager</li>
  <li>Strategist</li>
  <li>Back-tester</li>
  <li>Execution</li>
  <li>Portfolio management</li>
  <li>Risk analysis</li>
</ul>

<h2 id="what-is-the-quant-trading-skillset">What is the quant trading skillset?</h2>

<ul>
  <li>Intuition about trading
    <ul>
      <li>What strategies are there?</li>
      <li>What do people do?</li>
      <li>What do we, and donâ€™t we know?</li>
      <li>How do I develop an edge?</li>
    </ul>
  </li>
  <li>Statistical back-testing â€“ take an idea and test if it works
    <ul>
      <li>Econometrics</li>
      <li>Machine learning + alternative data</li>
    </ul>
  </li>
  <li>Executing trades
    <ul>
      <li>Programming</li>
      <li>Thinking about market rules</li>
      <li>Game theory / strategy</li>
    </ul>
  </li>
</ul>

<p>The required skills are too many for one person. Therefore we must focus on a subset.</p>

<p>This class is designed for quant strategists CS, you focus on building a back-test, light on economic intuition.</p>

<p>In some asset classes, execution trading is essentially irrelevant and quantitative valuation is all that matters.</p>

<p>For example my former life was traded via auctions and OTC.  Most of the quant trading workflow is on the strategy, data and back-testing side.</p>

<h2 id="definition-of-quant-trading-strategy">Definition of Quant Trading strategy</h2>

<div class="definition">
Quant trading strategies are repeatable, rules-based strategies.
</div>

<p><strong>Defined by these key features:</strong></p>

<ul>
  <li>Cross-sectional versus time-series
    <ul>
      <li>â€œrelative outperformanceâ€ versus â€œup or down performanceâ€</li>
    </ul>
  </li>
  <li>Horizon / frequency of trading
    <ul>
      <li>â€œweek or monthâ€™</li>
    </ul>
  </li>
  <li>Asset class â€œequity, bondâ€¦â€</li>
  <li>Instruments</li>
  <li>Strategy</li>
</ul>

<h2 id="why-quant">Why Quant</h2>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135571452782.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" />
<img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135571589988.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135571871550.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<ul>
  <li>Discretionary decisions are increasingly being fed by quant data
    <ul>
      <li>Alternative data, for example</li>
    </ul>
  </li>
  <li>Understanding how to be fluent in quant strategies helps you make discretionary trades too</li>
</ul>

<h2 id="useful-resources">Useful resources</h2>

<ul>
  <li><a href="https://quantocracy.com/">Quantocracy</a>
    <ul>
      <li>Daily blogs â€“ goal is to get you fluent in this discourse</li>
    </ul>
  </li>
</ul>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135574072897.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="-w1294" /></p>

<ul>
  <li>Textbooks â€“ Antan Ilmamenâ€™s â€œExpected Returnsâ€</li>
  <li>Machine learning - Marcos De Lo Pradoâ€™s book, can also look at Ernest Can + Kaggle.</li>
  <li><a href="https://quantpedia.com/">Quantpedia</a>
    <ul>
      <li>Has a list of academic papers per trading strategy available for free</li>
      <li>$300USD for a quarterly subscription â€“ which is cheap for institutional asset managers</li>
    </ul>
  </li>
  <li><a href="https://en.wikipedia.org/wiki/Quantopian">Quantopian</a></li>
</ul>

<h1 id="basics-of-quant-trading">Basics of Quant Trading</h1>

<p>A quantitative trading strategy aims to â€œoutperformâ€ and achieve high â€œreturn on riskâ€.</p>

<p>These are terms you probably have heard, letâ€™s unpack them slowly</p>

<ul>
  <li>What is a stock return?</li>
  <li>What is risk?
    <ul>
      <li>How do we think about risk?</li>
      <li>What statistical methodology do we use to calculate â€œoutperformâ€</li>
    </ul>
  </li>
</ul>

<h2 id="difference-between-price-and-return">Difference between price and return</h2>

<ul>
  <li>Stock price returns, not prices</li>
  <li>Transaction costs and liquidity
    <ul>
      <li>The return you get is the return minus the transaction has a cost</li>
      <li>Expected trading costs</li>
    </ul>
  </li>
</ul>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135615904374.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<p>Price changes are wrong because of the following problems.</p>

<h3 id="stock-split">Stock split</h3>

<p>Appleâ€™s stock has split four times since the company went public. The stock split on a 7-for-1 basis onÂ June 9, 2014Â and split on a 2-for-1 basis onÂ February 28, 2005,June 21, 2000, and June 16, 1987.</p>

<h3 id="dividends">Dividends</h3>

<p>The price of a stock should fall by the amount of the dividend. (Not exactly true due to taxes, see Ivo Welchâ€™s work)</p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135617253419.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<p><strong><em>Payouts are repurchases and dividends.</em></strong></p>

<p>About 1/4th of stocks pay dividends, important to consider:</p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135617563477.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<h3 id="definition-of-return">Definition of return</h3>

<p>A stock return includes both dividends and price appreciation:</p>

\[r_{t+1}=\frac{P_{t+1}-P_t + D_{t+1}}{P_t}\]

<p>After adjusting the price for splits â€“ your financial database should do this for you.</p>

<p>Another thing to consider is taxes:</p>

\[r_{t+1}=\frac{P_{t+1}-P_t + D_{t+1}}{P_t}(1-T)\]

<h3 id="financial-database-in-practice">Financial Database in practice</h3>

<p>Many databases have a field called stock return. The implicit assumption:</p>

<ul>
  <li>Dividends are reinvested immediately, with zero transaction costs</li>
  <li>Of course, this may not be true. if I get a 1% dividend and I cannot buy fractional shares.</li>
  <li>I may also need to wait 3 days to receive the money</li>
</ul>

<p>Some databases, if youâ€™re lucky, calculate returns. Most of the time, they give you, for example with Factset:</p>
<ul>
  <li>share price</li>
  <li>split adjustment factor</li>
  <li>Dividends</li>
  <li>Merger adjustment factor (rare)</li>
</ul>

<p><strong>Example: Compustat</strong></p>

<p>Professional and Industry use.</p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135620695590.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<p><strong>Example: CRSP</strong></p>

<p>Where will we get data from? CRSP! (Academic Use)</p>

<ul>
  <li>University of Chicago developed the  Center for Research on Security Prices (1961) with a grant from Merill Lynch
    <ul>
      <li>the first ever stock return database</li>
    </ul>
  </li>
  <li>Why was it good?
    <ul>
      <li>Accounted for historical de-listings and listings (survivorship bias)</li>
      <li>Calculated price returns that included dividends</li>
      <li>Included data from all available domestic exchanges</li>
    </ul>
  </li>
  <li>Roughly all stock data is structured similarly after CRSP set the standard</li>
</ul>

<p>For more info, see <a href="mweblib://16053223786055">Wharton Research Data Services</a>.</p>

<p><strong>Tiingo</strong></p>

<blockquote>
  <p>Made with Love Across the East Coast</p>

  <p>Tiingo was formed in 2014 and holds that belief that love is the ideal way to conduct business. We are a team made up of artists, engineers, and algorithmic hedge fund traders. Some of us have been professional photographers, and others have created trading algos managing hundreds of millions of dollars. We are united with the same goal: to make everyoneâ€™s life easier in the ways we know how.</p>

  <p>Our client base is made up of individuals, hedge funds, quant funds, fintech companies, academic institutions, and others. To see our complete product offering, please visit the Tiingo Welcome Page.</p>
</blockquote>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135667234399.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135667489846.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<p><strong>Bottom Line</strong>
We should care about the quality of the data.</p>

<p>Even professional databases may have bad data.</p>

<p>But always inspect very strange returns from a new database.
Generally, remove suspect observations or diagnose them and create a ruleset. So, for example any daily movements above 80%</p>

<h3 id="simple-and-compound-interest">Simple and compound interest</h3>

<h4 id="log-return-and-standard-return">Log return and standard return</h4>

<p>One of the most common applications of logarithms in finance is computing log returns. Log returns are defined as follows:</p>

\[\begin{equation}
r_{t} \equiv \ln \left(1+R_{t}\right) \quad \text { where } \quad R_{t}=\frac{P_{t}-P_{t-1}}{P_{t-1}}
\end{equation}\]

<p>Alternatively:</p>

\[e^{r_t}= 1+R_{t}=\frac{P_{t}}{P_{t-1}}\]

<p>To get a more precise estimate of the relationship between standard returns and log returns, we can use the following approximation:</p>

\[r\approx R-\frac{1}{2}R^2\]

<h4 id="compounding">Compounding</h4>

<p>To get the return of a security for two periods using simple returns, we have to do something that is not very intuitive, namely adding one to each of the returns, multiplying, and then subtracting one:</p>

\[\begin{equation}
R_{2, t}=\frac{P_{t}-P_{t-2}}{P_{t-2}}=\left(1+R_{1, t}\right)\left(1+R_{1, t-1}\right)-1
\end{equation}\]

<p>and for the log return:</p>

\[r_{2,t}=r_{1,t}+r_{1,t-1}\]

<h4 id="log-return-and-log-price">Log return and log price</h4>

<p>Define $p_t$ as the log of price $P_t$, then we have:</p>

\[r_t=ln(P_t/P_{t-1})=p_t-p_{t-1}\]

<p>As a result, we can check the log(price)-Time plot, to see whether the return is increasing:</p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/15938365361053.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="-w600" /></p>

<p>According to the graph above, the log return is constant, even though the price is increasing faster than a linear speed.</p>

<h4 id="cumulative-return">Cumulative return</h4>

<p>Cumulative return: compound every return before it. Keep compounding and keep track of the total wealth.</p>

<p>Assume $R_t$ is the standard return (with dividend reinvested), the compounded return is:</p>

\[\Pi_{t=0}^N  (R_t + 1) -1\]

<p>Assume the initial investment is 1 dollar, the Wealth process is defined as :</p>

\[W_t= \Pi_{t=0}^N  (R_t + 1)\]

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135680658087.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<h2 id="risks">Risks</h2>

<p>Many definitions of riskâ€¦</p>

<p>People may have different risk preferences:</p>

<ul>
  <li>Risk-neutral: who cares?</li>
  <li>Risk-loving</li>
  <li>Risk-averse</li>
</ul>

\[\text{Sharpe ratio SR_p}=\frac{r_p-r_f}{\sigma_p}\]

<p>Notice the difference between standard return and log-return:</p>

\[r_t=log(1+R_t)\]

\[\sigma_r \text{ vs } \sigma_R\]

<p>we may need to change the standard risk-free rate $R_f$ into the continuously compounded log-return.</p>

<p>Other metrics in industry (source : JPM)</p>

<p><strong>Maxdrawdown:</strong></p>

\[MaxDrawDown=\frac{Peak-Worst}{Peak}\]

<p>Other metrics in industry (source : JPM):</p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135744633001.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135745305901.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135747358360.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135747404056.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<p><strong>Key Insight:</strong></p>

<ul>
  <li>
    <p>The modern industry uses a more advanced statistical technique based on linear regression</p>
  </li>
  <li>
    <p>There are more advanced measures, but the baseline you need to fluently understand whitepapers is based on this</p>
  </li>
</ul>

<h2 id="risk-adjustment">Risk-adjustment</h2>

<p><strong>Roadmap:</strong></p>

<ul>
  <li>
    <p>What is risk-adjustment? What is risk?</p>
  </li>
  <li>
    <p>What is the role of a regression? How do we perform a regression and interpret a regression?</p>
  </li>
  <li>
    <p>Next module: cross-sectional strategies</p>
  </li>
</ul>

<p>Given a stock return series r you want to know if itâ€™s a good return on risk.</p>

<p>Sharpe ratio is a startâ€¦</p>

<ul>
  <li>The market has a Sharpe ratio of .4 and expected return of .06</li>
  <li>Suppose we have two strategies with a Sharpe ratio of .4</li>
  <li>How can we tell if strategy #2 is different than the market?</li>
  <li>How can we tell if combining them is a good idea or if theyâ€™re just correlated with each other?</li>
</ul>

<p><strong>Theories:</strong></p>

<ul>
  <li>Market efficiency</li>
  <li>Market beta</li>
  <li>â€œAlphaâ€</li>
</ul>

<p>It turns out they are all related!  And the framework here will provide the foundation for risk calculations</p>

<h3 id="market-efficiency-theory">Market Efficiency Theory</h3>

<p>The efficient-market hypothesis (EMH) is a hypothesis in financial economics that states that asset prices reflect all available information. A direct implication is that it is impossible to â€œbeat the marketâ€ consistently on a risk-adjusted basis since market prices should only react to new information</p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135753555761.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<p>Proposed in Fama (1970), by Nobel Prize winner Eugene Fama.</p>

<p>Three types of efficiency:</p>

<ul>
  <li>
    <p><strong>Strong form efficiency</strong> â€“ you can never make money that isnâ€™t compensation for risk â€œread: the market prices in all private infoâ€</p>
  </li>
  <li>
    <p><strong>Semi-strong form</strong> â€“  you can never make money that isnâ€™t compensation for risk unless you have private information â€œread: the market prices in all public infoâ€</p>
  </li>
  <li>
    <p><strong>Weak form efficiency</strong> â€“ you can never make money exceeding factor risk exposure using technical info; fundamentals-based alpha exists</p>
  </li>
</ul>

<h3 id="basic-takeaways-of-risk-adjustment-return-analysis">Basic Takeaways of Risk-adjustment return analysis</h3>

<p>Three attitudes towards the relationship between return and risk:</p>

<ul>
  <li>
    <p><strong>Market Efficiency</strong> $\iff$ Return on risk: so you are only  compensated for risk</p>
  </li>
  <li>
    <p><strong>Weaker Market Efficiency</strong> $\iff$ mispriced temporarily â€“ once realized then eliminated</p>
  </li>
  <li>
    <p><strong>Alternative</strong> $\iff$ mispricing â€“ the market is stupid persistently</p>
  </li>
</ul>

<p>You never really know which one it is.</p>

<ul>
  <li>For example: Nobel Prize was shared with Robert Shiller, who claimed that stock markets are irrational. The first finding of behavioral finance</li>
</ul>

<p>However, academics have this debate still today</p>

<h3 id="the-classic-risk-model--capm">The classic risk model -CAPM</h3>

<p>In finance, the <strong>capital asset pricing model (CAPM)</strong> is a model used to determine a theoretically appropriate required rate of return of an asset, to make decisions about adding assets to a well-diversified portfolio.</p>

<p><strong>Covariance-adjustment (CAPM framework)</strong></p>

<p>Basic idea: If the market tanks, and your stock tanks, it is risky.</p>

<p><strong>But there might be multiple risks</strong>.:</p>

<ul>
  <li>You can have a 3 factor, four factor, five factor risk model.</li>
  <li>What happens if the market doesnâ€™t fall but firms become less productive?</li>
  <li>What happens if consumers just stop demanding things?</li>
  <li>What happens if financial institutions have to unwind?</li>
</ul>

<p>Even if the market doesnâ€™t fall, there are risks</p>

<p><strong>CAPM framework for risk-adjustment</strong></p>

<p>Capital asset pricing model (CAPM) is the baseline model. Since it involves a regression, it is trivial to extend it from the CAPM to a multi-factor CAPM:</p>

<p>Under the CAPM:</p>

\[E\left[R_{t}^{s}-R_{t}^{f}\right]=\underbrace{\beta_{i}}_{\text { market risk }} * \underbrace{E\left[R_{t}^{m k t}-R_{t}^{f}\right]}_{\text {Market risk Premium}}\]

<p>On average, a securityâ€™s return is proportional to its market risk sensitivity.</p>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16135766893199.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="" /></p>

<ul>
  <li>Under the CAPM, idiosyncratic risk is not rewarded
    <ul>
      <li>If you donâ€™t like a stock, you sell it and buy another stock</li>
      <li>In equilibrium, everyone is fully diversified</li>
    </ul>
  </li>
  <li>In reality, stocks may outperform its beta-implied expected return. Because:
    <ul>
      <li>Not all risk factors captured</li>
      <li>Market beta mis-estimated</li>
      <li>Market not perfectly efficient, and there may be alpha</li>
    </ul>
  </li>
  <li>If we find that dots donâ€™t line up then â€¦ you can find stocks whose returns are higher than the sensitivity implied by CAPM</li>
</ul>

\[ğ‘Ÿ_{ğ‘ ğ‘¡}= ğ›¼+ğ›½_1 (ğ‘Ÿ_{ğ‘šğ‘˜ğ‘¡}âˆ’ğ‘Ÿ_ğ‘“)\]

<p>Here $r_{st}$ is the excess return of the strategy.</p>

<h3 id="variation-of-capm">Variation of CAPM</h3>

<ul>
  <li>
    <p><strong>Spoiler</strong>: the CAPM is too simple to explain average returns so we tried lots of different things</p>
  </li>
  <li>Different types of CAPM models â€¦ read Cochraneâ€™s Discount Rates (2008)
    <ul>
      <li>Production-based asset pricing , innovation risk,  labor risk, Liquidity risk , Intermediary health risk</li>
      <li>can stock prices be explained by their exposure to workers leaving the industry?</li>
      <li>can stock prices be explained by their exposure to being made obsolete by innovation</li>
    </ul>
  </li>
  <li>While interesting, these papers / debates uncover new economic reasonings for why stocks might produce return</li>
</ul>

<p>So now we have a â€œzooâ€ of factors in academia.</p>

<ul>
  <li>Three factor (1993) â€“ Fama French: market, size, value model</li>
  <li>Five-factor (mid 2000s) â€“ Fama French: market, size, investment, profitability model</li>
  <li>Even on a 7 factor model now</li>
</ul>

<p>They are called different things in industry. <strong>Barra model</strong> for example is one standard risk factor library.</p>

<p>&lt;div  class=â€œdefinitionâ€&gt;
A factor is a simple tradable strategy you put in this equation.</p>

<p>\(ğ‘Ÿ_{ğ‘ ğ‘¡}=ğ›¼+ğ›½_1 (ğ‘Ÿ_{ğ‘šğ‘˜ğ‘¡}âˆ’ğ‘Ÿ_ğ‘“)  + ğ›½_2 ğ‘“ğ‘ğ‘ğ‘¡ğ‘œğ‘Ÿ\)
&lt;/div&gt;</p>

<p><strong>Different views on risk factors:</strong></p>

<p><strong>Academically</strong>: risk factors are non-diversifiable sources of risk based on a description of how the economy works. These are factors that seem to explain what investors care about evidenced by the fact they earn high returns and nobody wants to buy the stock</p>

<p><strong>In practice</strong>: If you donâ€™t have alpha relative to this â€œbenchmarkâ€ model, then you lose zero opportunity cost.
Also, the betas can tell you your exposure to other known strategies</p>

<p>Whichever religion you have, you still need the same tool.</p>

<p><strong>Run the regression for k risk factors:</strong></p>

\[r_t^{strategy}=\alpha+ \sum_{i=1}^k \beta_i \text{. risk-factor}_i+\epsilon_t^{strategy}\]

<h3 id="another-perspective-of-risk-factor-models">Another perspective of risk-factor models</h3>

<p>Forget about the economic meaning of risk-factors, as well as the return compensated. Just regard these risk factor as investable strategy.</p>

<p>Remember, a risk factor is a simple tradable strategy: <strong>a self-financing excess return of long/short strategy for the risk factor</strong>.</p>

<p>The portfolio just invests in these risk factors according to the regressed ${\beta_i}_{i=1}^k$. We can calibrate the weights of each <strong>self-funding strategy</strong>, so that the portfolio can replicate the regressed result.</p>

<p>From the perspective above:</p>

\[\begin{cases}
\text{If $\alpha&gt;0$} &amp;\text{great!}\\
\text{If $\alpha=0$} &amp;\text{no cost still!}
\end{cases}\]

<h3 id="example-qmj">Example: QMJ</h3>

<p>AQR Capital Management, LLC â€” Quality Minus Junk: Factors, Daily.</p>

<p>This QMJ sheet contains daily <strong>self-financing excess returns of long/short Quality Minus Junk (QMJ) factors.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="n">smf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>

<span class="n">InteractiveShell</span><span class="p">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s">"all"</span>  <span class="c1"># multiple output per jupyter notebook code block
</span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_excel</span><span class="p">(</span>
    <span class="s">'qmj.xlsx'</span><span class="p">,</span>
    <span class="n">sheet_name</span><span class="o">=</span><span class="s">'QMJ Factors'</span><span class="p">,</span>
    <span class="n">skiprows</span><span class="o">=</span><span class="mi">18</span>
<span class="p">)</span>

<span class="n">market</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_excel</span><span class="p">(</span>
    <span class="s">'qmj.xlsx'</span><span class="p">,</span>
    <span class="n">sheet_name</span><span class="o">=</span><span class="s">'MKT'</span><span class="p">,</span>
    <span class="n">skiprows</span><span class="o">=</span><span class="mi">18</span>
<span class="p">)</span>


<span class="c1"># merge the QMJ table and market table
</span><span class="n">x2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">x</span><span class="p">[[</span><span class="s">'DATE'</span><span class="p">,</span> <span class="s">'USA'</span><span class="p">]],</span> <span class="n">market</span><span class="p">[[</span><span class="s">'DATE'</span><span class="p">,</span> <span class="s">'USA'</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s">'DATE'</span><span class="p">)</span> <span class="c1"># Excel sheet has QMJ data
</span><span class="n">x2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">'USA_x'</span><span class="p">:</span><span class="s">'qmj'</span><span class="p">,</span> <span class="s">'USA_y'</span><span class="p">:</span><span class="s">'mkt'</span><span class="p">})</span> <span class="c1"># Market has
</span>
<span class="n">x2</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">x2</span><span class="p">[</span><span class="s">'DATE'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="s">'DATE'</span><span class="p">])</span>


<span class="c1"># calculate the cumulated wealth process
</span><span class="n">x2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'DATE'</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">x2</span><span class="p">[</span><span class="s">'cum_ret_mkt'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="s">'mkt'</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="n">cumprod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">x2</span><span class="p">[</span><span class="s">'cum_ret_qmj'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="s">'qmj'</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="n">cumprod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">x2</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># Draw the wealth process
</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">x2</span>
    <span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">x2</span><span class="p">[</span><span class="s">'DATE'</span><span class="p">],</span> <span class="n">mkt</span><span class="o">=</span><span class="n">x2</span><span class="p">[</span><span class="s">'cum_ret_mkt'</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">qmj</span><span class="o">=</span><span class="n">x2</span><span class="p">[</span><span class="s">'cum_ret_qmj'</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'date'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s">'mkt'</span><span class="p">,</span> <span class="s">'qmj'</span><span class="p">],</span> <span class="n">logy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">).</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'cumulative return'</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16136579743602.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="-w719" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="c1"># calculate the sharpe ratio
## since it is daily data, we need to annualize it
</span>
<span class="p">{</span>
    <span class="s">'Sharpe MKT'</span><span class="p">:</span> <span class="n">x2</span><span class="p">[</span><span class="s">'mkt'</span><span class="p">].</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="n">x2</span><span class="p">[</span><span class="s">'mkt'</span><span class="p">].</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">255</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="s">'Sharpe QMJ'</span><span class="p">:</span> <span class="n">x2</span><span class="p">[</span><span class="s">'qmj'</span><span class="p">].</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="n">x2</span><span class="p">[</span><span class="s">'qmj'</span><span class="p">].</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">255</span><span class="o">**</span><span class="mf">0.5</span>
<span class="o">===</span>
<span class="n">Result</span><span class="p">:</span>
<span class="p">{</span><span class="s">'Sharpe MKT'</span><span class="p">:</span> <span class="mf">0.41714780189609474</span><span class="p">,</span> <span class="s">'Sharpe QMJ'</span><span class="p">:</span> <span class="mf">0.6714456894831614</span><span class="p">}</span>

<span class="p">}</span>


<span class="c1"># Regression QMT~MKT
</span><span class="n">olsm</span><span class="o">=</span><span class="n">smf</span><span class="p">.</span><span class="n">ols</span><span class="p">(</span><span class="s">'qmj ~ mkt'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">x2</span><span class="p">).</span><span class="n">fit</span><span class="p">()</span>
<span class="n">olsm</span><span class="p">.</span><span class="n">summary</span><span class="p">()</span>
<span class="c1"># We can also use print(olsm.summary().as_latex())
# or: print(olsm.summary().as_html())
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16136585746166.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="-w974" /></p>

<p><strong>What did we learn from this QMJ example?</strong></p>
<ul>
  <li>sharpe ratio is higher</li>
  <li>it is a negative $\beta$ strategy. ON average, when the market goes up by 1%, QMJ does down by .18% $\implies$ QMJ factor will diversify the MKT factor.</li>
  <li>QMJ has positive $\alpha$ with respect to market
    <ul>
      <li>it is very significant</li>
    </ul>
  </li>
  <li>
    <p>Therefore, a $\beta$ neutral strategy e.g. short market by .18cents for every dollar invested in QMJ will earn, on average, .02 basis points per day or 5.4 % per year</p>
  </li>
  <li>Because they are diversified and one has alpha with respect to another strategy, a blend should give diversification benefits and a higher Sharpe ratio</li>
</ul>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16136600380440.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="-w948" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">sklearn.metrics</span> <span class="k">as</span> <span class="n">metrics</span>
<span class="n">r2</span><span class="o">=</span><span class="n">metrics</span><span class="p">.</span><span class="n">r2_score</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="s">'qmj'</span><span class="p">],</span><span class="n">olsm</span><span class="p">.</span><span class="n">fittedvalues</span><span class="p">)</span>
<span class="n">rho</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>$\rho=0.45, SR_{QMJ}=0.67, SR_{MKT}=0.42$
We have the incremental Sharpe ratio of $S_{QMJ}^*$ is :
\(S_{QMJ}^* =  SR_{QMJ} - SR_{MKT}*\rho=0.481\)</p>

<p>As a result, adding QMJ to MKT will increase the sharpe ratio of MKT.</p>

<p><strong>In fact:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="p">{</span>
    <span class="s">'Sharpe 1/2 QMJ + 1/2 MKT'</span><span class="p">:</span> <span class="p">((</span><span class="n">x2</span><span class="p">[</span><span class="s">'mkt'</span><span class="p">]</span><span class="o">+</span><span class="n">x2</span><span class="p">[</span><span class="s">'qmj'</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="p">((</span><span class="n">x2</span><span class="p">[</span><span class="s">'mkt'</span><span class="p">]</span><span class="o">+</span><span class="n">x2</span><span class="p">[</span><span class="s">'qmj'</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">).</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">255</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="s">'Sharpe MKT'</span><span class="p">:</span> <span class="n">x2</span><span class="p">[</span><span class="s">'mkt'</span><span class="p">].</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="n">x2</span><span class="p">[</span><span class="s">'mkt'</span><span class="p">].</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">255</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="s">'Sharpe QMJ'</span><span class="p">:</span> <span class="n">x2</span><span class="p">[</span><span class="s">'qmj'</span><span class="p">].</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="n">x2</span><span class="p">[</span><span class="s">'qmj'</span><span class="p">].</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">255</span><span class="o">**</span><span class="mf">0.5</span>
<span class="p">}</span>


<span class="o">===</span>
<span class="c1">#Result:
</span><span class="p">{</span><span class="s">'Sharpe 1/2 QMJ + 1/2 MKT'</span><span class="p">:</span> <span class="mf">0.776779377105961</span><span class="p">,</span>
 <span class="s">'Sharpe MKT'</span><span class="p">:</span> <span class="mf">0.41714780189609474</span><span class="p">,</span>
 <span class="s">'Sharpe QMJ'</span><span class="p">:</span> <span class="mf">0.6714456894831614</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>
<span class="n">x2</span><span class="p">[</span><span class="s">'halfsies'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="s">'mkt'</span><span class="p">]</span><span class="o">+</span><span class="n">x2</span><span class="p">[</span><span class="s">'qmj'</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>

<span class="n">smf</span><span class="p">.</span><span class="n">ols</span><span class="p">(</span><span class="s">'halfsies ~ mkt + qmj'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">x2</span><span class="p">).</span><span class="n">fit</span><span class="p">().</span><span class="n">summary</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16136588079666.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="-w699" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="c1">#compare the half-size strategy and mkt
</span>
<span class="n">x2</span><span class="p">[</span><span class="s">'cum_halfsies'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="s">'halfsies'</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="n">cumprod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>


<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">x2</span>
    <span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">x2</span><span class="p">[</span><span class="s">'DATE'</span><span class="p">],</span> <span class="n">mkt</span><span class="o">=</span><span class="n">x2</span><span class="p">[</span><span class="s">'cum_ret_mkt'</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">halfsies</span><span class="o">=</span><span class="n">x2</span><span class="p">[</span><span class="s">'cum_halfsies'</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'date'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s">'mkt'</span><span class="p">,</span> <span class="s">'halfsies'</span><span class="p">],</span> <span class="n">logy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">).</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'cumulative return'</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="http://bens-1-pics.oss-cn-hongkong.aliyuncs.com/2022/05/17/16136588442967.jpg?x-oss-process=image/auto-orient,1/quality,q_90/watermark,text_YmVuc2Jsb2cudGVjaA,color_f5eded,size_15,x_10,y_10" alt="-w718" /></p>

<p>Note:</p>

<p>pd.assignæ˜¯ç›´æ¥å‘DataFrameå¯¹è±¡æ·»åŠ æ–°çš„ä¸€åˆ—</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'name'</span><span class="p">:[</span><span class="s">'lily'</span><span class="p">,</span><span class="s">'jack'</span><span class="p">,</span><span class="s">'hanson'</span><span class="p">,</span><span class="s">'bom'</span><span class="p">],</span><span class="s">'age'</span><span class="p">:</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span><span class="s">'gerder'</span><span class="p">:[</span><span class="s">'F'</span><span class="p">,</span><span class="s">'M'</span><span class="p">,</span><span class="s">'M'</span><span class="p">,</span><span class="s">'F'</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="my-own-replication-in-github">My own replication in Github</h2>

<p><a href="https://github.com/lengfc09/quantitative_trading/blob/main/replication-1.ipynb">Github_Jupyter_Notebook_1</a></p>

<p>To be continued..</p>
:ET